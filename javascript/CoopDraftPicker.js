var characters = [
  {
    folder: "4 Stars",
    image: "Character_Arlan_Icon.webp",
    element: "Lightning",
    path: "Destruction",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Argenti_Icon.webp",
    element: "Physical",
    path: "Erudition",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Asta_Icon.webp",
    element: "Fire",
    path: "Harmony",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Bailu_Icon.webp",
    element: "Lightning",
    path: "Abundance",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Black_Swan_Icon.webp",
    element: "Wind",
    path: "Nihility",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Blade_Icon.webp",
    element: "Wind",
    path: "Destruction",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Bronya_Icon.webp",
    element: "Wind",
    path: "Harmony",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Clara_Icon.webp",
    element: "Physical",
    path: "Destruction",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Dan_Heng_Icon.webp",
    element: "Wind",
    path: "Hunt",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Dan_Heng_Imbibitor_Lunae_Icon.webp",
    element: "Imaginary",
    path: "Destruction",
    gender: "Male",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Dr._Ratio_Icon.webp",
    element: "Imaginary",
    path: "Hunt",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Fu_Xuan_Icon.webp",
    element: "Quantum",
    path: "Preservation",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Gepard_Icon.webp",
    element: "Ice",
    path: "Preservation",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Guinaifen_Icon.webp",
    element: "Fire",
    path: "Nihility",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Hanya_Icon.webp",
    element: "Physical",
    path: "Harmony",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Herta_Icon.webp",
    element: "Ice",
    path: "Erudition",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Himeko_Icon.webp",
    element: "Fire",
    path: "Erudition",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Hook_Icon.webp",
    element: "Fire",
    path: "Destruction",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Huohuo_Icon.webp",
    element: "Wind",
    path: "Abundance",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Jing_Yuan_Icon.webp",
    element: "Lightning",
    path: "Erudition",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Jingliu_Icon.webp",
    element: "Ice",
    path: "Destruction",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Kafka_Icon.webp",
    element: "Lightning",
    path: "Nihility",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Luka_Icon.webp",
    element: "Physical",
    path: "Nihility",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Luocha_Icon.webp",
    element: "Imaginary",
    path: "Abundance",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Lynx_Icon.webp",
    element: "Quantum",
    path: "Abundance",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_March_7th_Icon.webp",
    element: "Ice",
    path: "Preservation",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Misha_Icon.webp",
    element: "Ice",
    path: "Destruction",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Natasha_Icon.webp",
    element: "Physical",
    path: "Abundance",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Pela_Icon.webp",
    element: "Ice",
    path: "Nihility",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Qingque_Icon.webp",
    element: "Quantum",
    path: "Erudition",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Ruan_Mei_Icon.webp",
    element: "Ice",
    path: "Harmony",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Sampo_Icon.webp",
    element: "Wind",
    path: "Nihility",
    gender: "Male",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Seele_Icon.webp",
    element: "Quantum",
    path: "Hunt",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Serval_Icon.webp",
    element: "Lightning",
    path: "Nihility",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Silver_Wolf_Icon.webp",
    element: "Quantum",
    path: "Nihility",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Sushang_Icon.webp",
    element: "Physical",
    path: "Hunt",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "4 Stars",
    image: "Character_Tingyun_Icon.webp",
    element: "Lightning",
    path: "Harmony",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Topaz_and_Numby_Icon.webp",
    element: "Fire",
    path: "Hunt",
    gender: "Female",
    range: "Ranged",
  },

  {
    folder: "5 Stars",
    image: "Character_Trailblazer_Icon.webp",
    element: "Wild Card",
    path: "Wild Card",
    gender: "Wild Card",
    range: "Wild Card",
  },

  {
    folder: "5 Stars",
    image: "Character_Welt_Icon.webp",
    element: "Imaginary",
    path: "Nihility",
    gender: "Male",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Xueyi_Icon.webp",
    element: "Quantum",
    path: "Destruction",
    gender: "Female",
    range: "Melee",
  },

  {
    folder: "5 Stars",
    image: "Character_Yanqing_Icon.webp",
    element: "Ice",
    path: "Hunt",
    gender: "Male",
    range: "Ranged",
  },

  {
    folder: "4 Stars",
    image: "Character_Yukong_Icon.webp",
    element: "Imaginary",
    path: "Harmony",
    gender: "Female",
    range: "Ranged",
  },
];

var newPool = [];
var disabledPool = [];
var selectedPool = [];
var charactersAdded = 0;

document.addEventListener("DOMContentLoaded", function () {
  var pageTitle = document.createElement("h2");
  pageTitle.textContent = "Disable Characters";
  document.body.appendChild(pageTitle);

  var fireImage = document.querySelector(
    ".element_filters img[src='Elements/Fire.png']"
  );
  var iceImage = document.querySelector(
    ".element_filters img[src='Elements/Ice.png']"
  );
  var imaginaryImage = document.querySelector(
    ".element_filters img[src='Elements/Imaginary.png']"
  );
  var lightningImage = document.querySelector(
    ".element_filters img[src='Elements/Lightning.png']"
  );
  var physicalImage = document.querySelector(
    ".element_filters img[src='Elements/Physical.png']"
  );
  var quantumImage = document.querySelector(
    ".element_filters img[src='Elements/Quantum.png']"
  );
  var windImage = document.querySelector(
    ".element_filters img[src='Elements/Wind.png']"
  );

  fireImage.addEventListener("click", function (event) {
    toggleFilter("Fire", event.target);
  });

  iceImage.addEventListener("click", function (event) {
    toggleFilter("Ice", event.target);
  });

  imaginaryImage.addEventListener("click", function (event) {
    toggleFilter("Imaginary", event.target);
  });

  lightningImage.addEventListener("click", function (event) {
    toggleFilter("Lightning", event.target);
  });

  physicalImage.addEventListener("click", function (event) {
    toggleFilter("Physical", event.target);
  });

  quantumImage.addEventListener("click", function (event) {
    toggleFilter("Quantum", event.target);
  });

  windImage.addEventListener("click", function (event) {
    toggleFilter("Wind", event.target);
  });

  var abundanceImage = document.querySelector(
    ".element_filters img[src='Paths/Abundance.png']"
  );
  var desturctionImage = document.querySelector(
    ".element_filters img[src='Paths/Destruction.png']"
  );
  var eruditionImage = document.querySelector(
    ".element_filters img[src='Paths/Erudition.png']"
  );
  var harmonyImage = document.querySelector(
    ".element_filters img[src='Paths/Harmony.png']"
  );
  var huntImage = document.querySelector(
    ".element_filters img[src='Paths/Hunt.png']"
  );
  var nihilityImage = document.querySelector(
    ".element_filters img[src='Paths/Nihility.png']"
  );
  var preservationImage = document.querySelector(
    ".element_filters img[src='Paths/Preservation.png']"
  );

  abundanceImage.addEventListener("click", function (event) {
    togglePathFilter("Abundance", event.target);
  });

  desturctionImage.addEventListener("click", function (event) {
    togglePathFilter("Destruction", event.target);
  });
  eruditionImage.addEventListener("click", function (event) {
    togglePathFilter("Erudition", event.target);
  });

  harmonyImage.addEventListener("click", function (event) {
    togglePathFilter("Harmony", event.target);
  });

  huntImage.addEventListener("click", function (event) {
    togglePathFilter("Hunt", event.target);
  });

  nihilityImage.addEventListener("click", function (event) {
    togglePathFilter("Nihility", event.target);
  });

  preservationImage.addEventListener("click", function (event) {
    togglePathFilter("Preservation", event.target);
  });

  var femaleImage = document.querySelector(
    ".element_filters img[src='Gender/Female.png']"
  );
  var maleImage = document.querySelector(
    ".element_filters img[src='Gender/Male.png']"
  );

  femaleImage.addEventListener("click", function (event) {
    toggleGenderFilter("Female", event.target);
  });
  maleImage.addEventListener("click", function (event) {
    toggleGenderFilter("Male", event.target);
  });

  var rangedImage = document.querySelector(
    ".element_filters img[src='Range/Ranged.png']"
  );
  var meleeImage = document.querySelector(
    ".element_filters img[src='Range/Melee.png']"
  );

  rangedImage.addEventListener("click", function (event) {
    toggleRangeFilter("Ranged", event.target);
  });
  meleeImage.addEventListener("click", function (event) {
    toggleRangeFilter("Melee", event.target);
  });

  var fourStarImage = document.querySelector(
    ".element_filters img[src='Rarity/Star4.png']"
  );
  var fiveStarImage = document.querySelector(
    ".element_filters img[src='Rarity/Star5.png']"
  );

  fourStarImage.addEventListener("click", function (event) {
    toggleRarityFilter("Star4", event.target);
  });
  fiveStarImage.addEventListener("click", function (event) {
    toggleRarityFilter("Star5", event.target);
  });

  var characterGrid = document.createElement("div");
  characterGrid.classList.add("character-grid");
  characterGrid.id = "characterGrid";

  characters.forEach(function (character) {
    var characterContainer = document.createElement("button");
    characterContainer.classList.add("CharacterCard");

    var portraitDiv = document.createElement("div");
    portraitDiv.classList.add("CharacterPortrait");
    var portraitImg = document.createElement("img");

    var imageName = character.image
      .replace("Character_", "")
      .replace("_Icon.webp", "");

    imageName = imageName.replace(/_/g, " ");

    portraitImg.src =
      "Character Icons/" + character.folder + "/" + character.image;
    portraitDiv.appendChild(portraitImg);

    var elementDiv = document.createElement("div");
    elementDiv.classList.add("Element");
    var elementImg = document.createElement("img");
    elementImg.src = "Elements/" + character.element + ".png";
    elementImg.atl = character.element;

    elementDiv.appendChild(elementImg);

    var pathDiv = document.createElement("div");
    pathDiv.classList.add("Path");
    var pathImg = document.createElement("img");
    pathImg.src = "Paths/" + character.path + ".png";
    pathImg.alt = character.path;
    pathDiv.appendChild(pathImg);
    var nameDiv = document.createElement("div");
    nameDiv.textContent = imageName;
    nameDiv.classList.add("CharacterName");

    var genderDiv = document.createElement("div");

    if (character.gender.trim() === "Female") {
      genderDiv.classList.add("Female");
    } else if (character.gender.trim() === "Male") {
      genderDiv.classList.add("Male");
    }

    var rangedDiv = document.createElement("div");
    if (character.range.trim() === "Ranged") {
      rangedDiv.classList.add("Ranged");
    } else if (character.range.trim() === "Melee") {
      rangedDiv.classList.add("Melee");
    }

    var rarityDiv = document.createElement("div");
    if (character.folder === "4 Stars") {
      rarityDiv.classList.add("Star4");
      portraitImg.style.background =
        "linear-gradient(to bottom, #404066, #9864cd)";
    } else if (character.folder === "5 Stars") {
      rarityDiv.classList.add("Star5");
      portraitImg.style.background =
        "linear-gradient(to bottom, #915b52, #c6a470)";
    }
    characterContainer.appendChild(portraitDiv);
    characterContainer.appendChild(elementDiv);
    characterContainer.appendChild(pathDiv);
    characterContainer.appendChild(nameDiv);
    characterContainer.appendChild(genderDiv);
    characterContainer.appendChild(rangedDiv);
    characterContainer.appendChild(rarityDiv);

    characterContainer.addEventListener("click", function () {
      var index = disabledPool.findIndex(function (item) {
        return item.image === character.image;
      });

      if (index === -1) {
        disabledPool.push(character);
        this.classList.add("disabled");
      } else {
        disabledPool.splice(index, 1);
        this.classList.remove("disabled");
      }
    });
    characterGrid.appendChild(characterContainer);
  });

  document.body.appendChild(characterGrid);

  var containerDiv = document.createElement("div");
  containerDiv.classList.add("button-container");

  var hostDiv = document.createElement("div");
  var hostButton = document.createElement("button");
  hostButton.textContent = "Start The Draft as Host";
  hostButton.classList.add("draft-button");
  hostDiv.classList.add("host-setup");
  hostDiv.appendChild(hostButton);

  var guestDiv = document.createElement("div");

  var inputData = document.createElement("input");
  inputData.type = "text";
  inputData.classList.add("input-field");
  inputData.placeholder = "Enter Seed Here...";
  guestDiv.classList.add("guest-setup");
  guestDiv.appendChild(inputData);

  var guestButton = document.createElement("button");
  guestButton.textContent = "Start The Draft as Guest";
  guestButton.classList.add("draft-button");
  guestDiv.appendChild(guestButton);

  containerDiv.appendChild(hostDiv);
  containerDiv.appendChild(guestDiv);

  document.body.appendChild(containerDiv);

  var draftGrid = document.createElement("div");
  draftGrid.classList.add("draft-grid");
  draftGrid.id = "characterGrid";
  document.body.appendChild(draftGrid);

  hostButton.addEventListener("click", function () {
    var existingH2 = document.querySelector("h2");
    if (existingH2) {
      existingH2.parentNode.removeChild(existingH2);
    }

    var filtersSegment = document.querySelector(".filters");
    if (filtersSegment) {
      filtersSegment.parentNode.removeChild(filtersSegment);
    }

    var buttonsSegment = document.querySelector(".button-container");
    if (buttonsSegment) {
      buttonsSegment.parentNode.removeChild(buttonsSegment);
    }

    var draftGrid = document.querySelector(".draft-grid");

    draftGrid.innerHTML = "";
    characterGrid.innerHTML = "";

    var pool = makePool();
    BeginDraft(pool, draftGrid);
  });
  guestButton.addEventListener("click", function () {
    var existingH2 = document.querySelector("h2");
    if (existingH2) {
      existingH2.parentNode.removeChild(existingH2);
    }

    var filtersSegment = document.querySelector(".filters");
    if (filtersSegment) {
      filtersSegment.parentNode.removeChild(filtersSegment);
    }

    var buttonsSegment = document.querySelector(".button-container");
    if (buttonsSegment) {
      buttonsSegment.parentNode.removeChild(buttonsSegment);
    }

    var draftGrid = document.querySelector(".draft-grid");

    draftGrid.innerHTML = "";
    characterGrid.innerHTML = "";

    var pool = makePool();
    var encryptedSeed = inputData.value;
    var seed = decryptSeed(encryptedSeed);

    BeginSeededDraft(pool, draftGrid, seed);
  });
});

function makePool() {
  return characters.filter(function (character) {
    return !disabledPool.includes(character);
  });
}

function BeginDraft(pool, draftGrid) {
  var seed = generateCustomSeed(pool.length);

  var displaySeed = encryptSeed(seed);

  var newH2 = document.createElement("h2");
  newH2.textContent = "Draft Seed: " + displaySeed;
  if (draftGrid) {
    draftGrid.parentNode.insertBefore(newH2, draftGrid);
  }

  seed = seed.slice(1);

  var index1 = seed[0];
  var index2 = seed[1];
  var index3 = seed[2];
  seed = seed.slice(1);
  seed = seed.slice(1);
  seed = seed.slice(1);

  var selectedCharacters = [pool[index1], pool[index2], pool[index3]];

  selectedCharacters.forEach(function (character, index) {
    var characterContainer = document.createElement("button");
    characterContainer.classList.add("DraftCard");

    var portraitDiv = document.createElement("div");
    portraitDiv.classList.add("DraftPortrait");
    var portraitImg = document.createElement("img");

    if (index === 0) {
      portraitImg.src =
        "Character Icons/" + character.folder + "/" + character.image;
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    } else {
      portraitImg.src = "random.png";
      portraitImg.addEventListener("mouseover", function () {
        portraitImg.src = "randomhover.png";
      });

      portraitImg.addEventListener("mouseout", function () {
        portraitImg.src = "random.png";
      });
    }

    portraitDiv.appendChild(portraitImg);

    portraitDiv.addEventListener("mouseenter", function () {
      portraitImg.style.background = "#cad4ff";
    });

    portraitDiv.addEventListener("mouseleave", function () {
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    });

    characterContainer.onclick = function () {
      if (index === 0) {
        if (character.folder === "4 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #404066, #9864cd)";
        } else if (character.folder === "5 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #915b52, #c6a470)";
        }

        console.log(pool);
        var index = pool.indexOf(character);
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);

        refreshDraftGrid(pool, draftGrid, seed);
      } else {
        var characterImage = document.createElement("img");
        characterImage.src =
          "Character Icons/" + character.folder + "/" + character.image;
        console.log(pool);

        var index = pool.findIndex(function (poolCharacter) {
          return (
            poolCharacter.folder === character.folder &&
            poolCharacter.image === character.image
          );
        });
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);
        displaySelectedCharacter(characterImage, character);
        refreshDraftGrid(pool, draftGrid, seed);
      }
    };

    characterContainer.appendChild(portraitDiv);
    draftGrid.appendChild(characterContainer);
  });

  createTable();
}

function BeginSeededDraft(pool, draftGrid, seed) {
  var displaySeed = encryptSeed(seed);

  var newH2 = document.createElement("h2");
  newH2.textContent = "Draft Seed: " + displaySeed;
  if (draftGrid) {
    draftGrid.parentNode.insertBefore(newH2, draftGrid);
  }

  seed = seed.slice(1);

  var index1 = seed[0];
  var index2 = seed[1];
  var index3 = seed[2];
  seed = seed.slice(1);
  seed = seed.slice(1);
  seed = seed.slice(1);

  var selectedCharacters = [pool[index1], pool[index2], pool[index3]];

  selectedCharacters.forEach(function (character, index) {
    var characterContainer = document.createElement("button");
    characterContainer.classList.add("DraftCard");

    var portraitDiv = document.createElement("div");
    portraitDiv.classList.add("DraftPortrait");
    var portraitImg = document.createElement("img");

    if (index === 2) {
      portraitImg.src =
        "Character Icons/" + character.folder + "/" + character.image;
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    } else {
      portraitImg.src = "random.png";
      portraitImg.addEventListener("mouseover", function () {
        portraitImg.src = "randomhover.png";
      });

      portraitImg.addEventListener("mouseout", function () {
        portraitImg.src = "random.png";
      });
    }

    portraitDiv.appendChild(portraitImg);

    portraitDiv.addEventListener("mouseenter", function () {
      portraitImg.style.background = "#cad4ff";
    });

    portraitDiv.addEventListener("mouseleave", function () {
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    });

    characterContainer.onclick = function () {
      if (index === 2) {
        if (character.folder === "4 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #404066, #9864cd)";
        } else if (character.folder === "5 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #915b52, #c6a470)";
        }

        console.log(pool);
        var index = pool.indexOf(character);
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);

        refreshSeededDraftGrid(pool, draftGrid, seed);
      } else {
        var characterImage = document.createElement("img");
        characterImage.src =
          "Character Icons/" + character.folder + "/" + character.image;
        console.log(pool);

        var index = pool.findIndex(function (poolCharacter) {
          return (
            poolCharacter.folder === character.folder &&
            poolCharacter.image === character.image
          );
        });
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);
        displaySelectedCharacter(characterImage, character);
        refreshSeededDraftGrid(pool, draftGrid, seed);
      }
    };

    characterContainer.appendChild(portraitDiv);
    draftGrid.appendChild(characterContainer);
  });

  createTable();
}

function refreshDraftGrid(pool, draftGrid, seed) {
  draftGrid.innerHTML = "";

  var index1 = seed[0];
  var index2 = seed[1];
  var index3 = seed[2];
  seed = seed.slice(1);
  seed = seed.slice(1);
  seed = seed.slice(1);

  var selectedCharacters = [pool[index1], pool[index2], pool[index3]];

  selectedCharacters.forEach(function (character, index) {
    var characterContainer = document.createElement("button");
    characterContainer.classList.add("DraftCard");

    var portraitDiv = document.createElement("div");
    portraitDiv.classList.add("DraftPortrait");
    var portraitImg = document.createElement("img");

    if (index === 0) {
      portraitImg.src =
        "Character Icons/" + character.folder + "/" + character.image;
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    } else {
      portraitImg.src = "random.png";
      portraitImg.addEventListener("mouseover", function () {
        portraitImg.src = "randomhover.png";
      });

      portraitImg.addEventListener("mouseout", function () {
        portraitImg.src = "random.png";
      });
    }

    portraitDiv.appendChild(portraitImg);

    portraitDiv.addEventListener("mouseenter", function () {
      portraitImg.style.background = "#cad4ff";
    });

    portraitDiv.addEventListener("mouseleave", function () {
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    });

    characterContainer.onclick = function () {
      if (index === 0) {
        if (character.folder === "4 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #404066, #9864cd)";
        } else if (character.folder === "5 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #915b52, #c6a470)";
        }

        console.log(pool);
        var index = pool.indexOf(character);
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);

        refreshDraftGrid(pool, draftGrid, seed);
      } else {
        var characterImage = document.createElement("img");
        characterImage.src =
          "Character Icons/" + character.folder + "/" + character.image;
        console.log(pool);

        var index = pool.findIndex(function (poolCharacter) {
          return (
            poolCharacter.folder === character.folder &&
            poolCharacter.image === character.image
          );
        });
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);
        displaySelectedCharacter(characterImage, character);
        if (charactersAdded !== 12) {
          refreshDraftGrid(pool, draftGrid, seed);
        } else {
          draftGrid.remove();
        }
      }
    };

    characterContainer.appendChild(portraitDiv);
    draftGrid.appendChild(characterContainer);
  });
}

function refreshSeededDraftGrid(pool, draftGrid, seed) {
  draftGrid.innerHTML = "";

  var index1 = seed[0];
  var index2 = seed[1];
  var index3 = seed[2];
  seed = seed.slice(1);
  seed = seed.slice(1);
  seed = seed.slice(1);

  var selectedCharacters = [pool[index1], pool[index2], pool[index3]];

  selectedCharacters.forEach(function (character, index) {
    var characterContainer = document.createElement("button");
    characterContainer.classList.add("DraftCard");

    var portraitDiv = document.createElement("div");
    portraitDiv.classList.add("DraftPortrait");
    var portraitImg = document.createElement("img");

    if (index === 2) {
      portraitImg.src =
        "Character Icons/" + character.folder + "/" + character.image;
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    } else {
      portraitImg.src = "random.png";
      portraitImg.addEventListener("mouseover", function () {
        portraitImg.src = "randomhover.png";
      });

      portraitImg.addEventListener("mouseout", function () {
        portraitImg.src = "random.png";
      });
    }

    portraitDiv.appendChild(portraitImg);

    portraitDiv.addEventListener("mouseenter", function () {
      portraitImg.style.background = "#cad4ff";
    });

    portraitDiv.addEventListener("mouseleave", function () {
      if (character.folder === "4 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #404066, #9864cd)";
      } else if (character.folder === "5 Stars") {
        portraitImg.style.background =
          "linear-gradient(to bottom, #915b52, #c6a470)";
      }
    });

    characterContainer.onclick = function () {
      if (index === 2) {
        if (character.folder === "4 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #404066, #9864cd)";
        } else if (character.folder === "5 Stars") {
          portraitImg.style.background =
            "linear-gradient(to bottom, #915b52, #c6a470)";
        }

        console.log(pool);
        var index = pool.indexOf(character);
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);

        refreshSeededDraftGrid(pool, draftGrid, seed);
      } else {
        var characterImage = document.createElement("img");
        characterImage.src =
          "Character Icons/" + character.folder + "/" + character.image;
        console.log(pool);

        var index = pool.findIndex(function (poolCharacter) {
          return (
            poolCharacter.folder === character.folder &&
            poolCharacter.image === character.image
          );
        });
        if (index !== -1) {
          pool.splice(index, 1);
        }
        console.log(pool);
        displaySelectedCharacter(characterImage, character);
        if (charactersAdded !== 12) {
          refreshSeededDraftGrid(pool, draftGrid, seed);
        } else {
          draftGrid.remove();
        }
      }
    };

    characterContainer.appendChild(portraitDiv);
    draftGrid.appendChild(characterContainer);
  });
}

function createTable() {
  var table = document.createElement("table");
  var tableBody = document.createElement("tbody");
  table.appendChild(tableBody);

  tableBody.id = "selectedCharactersTableBody";

  var draftGrid = document.querySelector(".draft-grid");
  draftGrid.insertAdjacentElement("afterend", table);
}

function displaySelectedCharacter(portraitImgElement, character) {
  var tableBody = document.getElementById("selectedCharactersTableBody");

  var currentRow = tableBody.rows[tableBody.rows.length - 1];
  if (!currentRow || currentRow.cells.length >= 4 || charactersAdded >= 12) {
    currentRow = tableBody.insertRow();
  }

  if (charactersAdded < 12) {
    var newCell = currentRow.insertCell();

    if (character.folder === "4 Stars") {
      newCell.style.background = "linear-gradient(to bottom, #404066, #9864cd)";
    } else if (character.folder === "5 Stars") {
      newCell.style.background = "linear-gradient(to bottom, #915b52, #c6a470)";
    }

    newCell.appendChild(portraitImgElement);

    charactersAdded++;
  }
}

function toggleFilter(element, clickedImage) {
  var isActive = clickedImage.classList.contains("active");

  var allFilters = document.querySelectorAll(".element_filters img");

  if (isActive) {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });
    var characterCards = document.querySelectorAll(".CharacterCard");
    characterCards.forEach(function (card) {
      card.style.display = "";
    });
  } else {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });

    clickedImage.classList.add("active");

    var characterCards = document.querySelectorAll(".CharacterCard");

    characterCards.forEach(function (card) {
      if (
        card.querySelector(".Element img[src='Elements/" + element + ".png']")
      ) {
        card.style.display = "";
      } else {
        card.style.display = "none";
      }
    });
  }
}

function togglePathFilter(element, clickedImage) {
  var isActive = clickedImage.classList.contains("active");

  var allFilters = document.querySelectorAll(".element_filters img");

  if (isActive) {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });
    var characterCards = document.querySelectorAll(".CharacterCard");
    characterCards.forEach(function (card) {
      card.style.display = "";
    });
  } else {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });

    clickedImage.classList.add("active");

    var characterCards = document.querySelectorAll(".CharacterCard");

    characterCards.forEach(function (card) {
      if (card.querySelector(".Path img[src='Paths/" + element + ".png']")) {
        card.style.display = "";
      } else {
        card.style.display = "none";
      }
    });
  }
}

function toggleGenderFilter(element, clickedImage) {
  var isActive = clickedImage.classList.contains("active");

  var allFilters = document.querySelectorAll(".element_filters img");

  if (isActive) {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });
    var characterCards = document.querySelectorAll(".CharacterCard");
    characterCards.forEach(function (card) {
      card.style.display = "";
    });
  } else {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });

    clickedImage.classList.add("active");

    var characterCards = document.querySelectorAll(".CharacterCard");

    characterCards.forEach(function (card) {
      if (card.querySelector("." + element)) {
        card.style.display = "";
      } else {
        card.style.display = "none";
      }
    });
  }
}

function toggleRangeFilter(element, clickedImage) {
  var isActive = clickedImage.classList.contains("active");

  var allFilters = document.querySelectorAll(".element_filters img");

  if (isActive) {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });
    var characterCards = document.querySelectorAll(".CharacterCard");
    characterCards.forEach(function (card) {
      card.style.display = "";
    });
  } else {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });

    clickedImage.classList.add("active");

    var characterCards = document.querySelectorAll(".CharacterCard");

    characterCards.forEach(function (card) {
      if (card.querySelector("." + element)) {
        card.style.display = "";
      } else {
        card.style.display = "none";
      }
    });
  }
}

function toggleRarityFilter(element, clickedImage) {
  var isActive = clickedImage.classList.contains("active");

  var allFilters = document.querySelectorAll(".element_filters img");

  if (isActive) {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });
    var characterCards = document.querySelectorAll(".CharacterCard");
    characterCards.forEach(function (card) {
      card.style.display = "";
    });
  } else {
    allFilters.forEach(function (filter) {
      filter.classList.remove("active");
    });

    clickedImage.classList.add("active");

    var characterCards = document.querySelectorAll(".CharacterCard");

    characterCards.forEach(function (card) {
      if (card.querySelector("." + element)) {
        card.style.display = "";
      } else {
        card.style.display = "none";
      }
    });
  }
}

function generateCustomSeed(poolLength) {
  var seedElements = [];
  seedElements.push(poolLength);

  var loopLimit = Math.min(12, poolLength);

  for (var i = 0; i < loopLimit; i++) {
    var generatedNumbers = [];

    for (var j = 0; j < 3; j++) {
      var randomNumber;

      do {
        randomNumber = Math.floor(Math.random() * (poolLength - i));
      } while (generatedNumbers.includes(randomNumber));

      generatedNumbers.push(randomNumber);
      seedElements.push(randomNumber);
    }
  }
  return seedElements;
}
function encryptSeed(seedElements) {
  var encryptedSeed = "";

  for (var i = 0; i < seedElements.length; i++) {
    var hex = seedElements[i].toString(16).padStart(2, "0");

    encryptedSeed += hex;
  }

  return encryptedSeed;
}

function decryptSeed(encryptedSeed) {
  var decryptedSeed = [];

  for (var i = 0; i < encryptedSeed.length; i += 2) {
    var hexPair = encryptedSeed.substring(i, i + 2);

    decryptedSeed.push(parseInt(hexPair, 16));
  }

  return decryptedSeed;
}
